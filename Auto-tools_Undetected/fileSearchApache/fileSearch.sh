#!/bin/bash


# Find apache files by date's mail

# Filtering directories
echo "[+] Creating dictionary of apache directories..."
find / -name "apache2" 2> /dev/null > paths

sleep 2

tput civis

# Searching files
echo -e "\n[+] Searching mail..."
mail_path=$(find / -type f -name $(whoami) 2> /dev/null)
echo $mail_path

echo -e "\n[+] Extracting date mail..."
email_date=$(date -r $mail_path "+%Y-%m-%d")
echo $email_date

declare -i date=${email_date:5:2}
let date-=3
modify_date=$(echo ${email_date:0:4}-"0$date"-${email_date:8:2})

echo -e "\n[+] Searching for modified files 3 months before the email was sent... ($modify_date - $email_date)"
while read path; do
        if [ -d $path ]; then
                echo -e "\t[+] Searching in path $path:";
                find $path -type f -newermt $modify_date ! -newermt $email_date -not -empty -ls 2> /dev/null;
                sleep 2;
        fi
done < paths

rm paths

tput cnorm
