#!/bin/bash

# Host discovery
# --------------

# check if the host if live
is_alive()
{
  # send ICMP packets and wait for response
  ping -c 1 $1 > /dev/null
  # check status code successful (= 0)
  [ $? -eq 0 ] && echo Host $i: UP.
}

echo -e "\nHost discovery:\n"
for i in 172.17.0.{1..255} 
do
  # run function and pass it to the background
  is_alive $i & disown
done

# --------------


# Port discovery
# --------------
echo -e "\nPort discovery:\n"

declare -a hosts=(172.17.0.1 172.17.0.2 172.17.0.3 172.17.0.4 172.17.0.5 172.17.0.6)

for host in "${hosts[@]}"
do
  echo "Host $host:"
  for port in $(seq 1 36000)
  do
    timeout 1 bash -c "echo '' > /dev/tcp/$host/$port && echo -e '\tPort $port: OPEN'" 2>/dev/null &
  done
done; wait

# --------------
